[tox]
min_version = 4.0
env_list = py38,py39,py310,py311,py312,lint,security,docs

[testenv]
deps = 
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-xdist>=3.3.0
    pytest-benchmark
    pytest-mock
commands = pytest {posargs} -n auto --cov=src --cov-report=term-missing --cov-report=html --cov-fail-under=95

[testenv:lint]
deps = 
    ruff>=0.1.0
    mypy>=1.8.0
    types-PyYAML
    types-requests
commands = 
    ruff check src tests
    ruff format --check src tests
    mypy src

[testenv:security]
deps = 
    bandit[toml]>=1.7.0
    safety>=2.0.0
commands = 
    bandit -r src -f json -o bandit-report.json
    safety check --json

[testenv:docs]
deps = 
    sphinx>=7.0.0
    sphinx-rtd-theme
    myst-parser
commands = 
    sphinx-build -b html docs docs/_build/html
    sphinx-build -b linkcheck docs docs/_build/linkcheck

[testenv:benchmarks]
deps = 
    pytest-benchmark
    {[testenv]deps}
commands = pytest benchmarks/ --benchmark-only --benchmark-json=benchmark-report.json

[testenv:integration]
deps = 
    {[testenv]deps}
    docker
    requests
setenv = 
    INTEGRATION_TESTS = true
commands = pytest tests/ -m integration -v

[testenv:mutation]
deps = 
    mutmut>=2.4.0
    {[testenv]deps}
commands = 
    mutmut run --paths-to-mutate src/
    mutmut results

[testenv:coverage]
deps = 
    coverage[toml]>=7.0.0
    {[testenv]deps}
commands = 
    coverage run -m pytest
    coverage report --show-missing --fail-under=95
    coverage html
    coverage xml